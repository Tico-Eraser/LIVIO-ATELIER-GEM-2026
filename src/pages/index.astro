---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';

// GÜVENLİK DİKİŞİ: Klasör boşsa dükkanın çökmesini engeller
let featuredProducts = [];
try {
  const allProducts = await getCollection('products');
  featuredProducts = allProducts ? allProducts.slice(0, 6) : [];
} catch (e) {
  featuredProducts = []; 
}
---

<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<Layout title="LIVIO | Premium Leather Atelier">
  <div class="redesign-banner">LIVIO — Yönetim Paneli ve Kimlik Doğrulama Devrede</div>

  <nav class="premium-nav">
    <a class="nav-brand" href="/">LIVIO</a>
    <div class="nav-right">
      <div class="lang-switcher">
        <a href="#" class="active">EN</a>
        <span class="lang-sep">|</span>
        <a href="#">TR</a>
      </div>
      <button onclick="netlifyIdentity.open()" class="nav-contact">Giriş Yap / Şifre Al</button>
    </div>
  </nav>

  <section class="hero">
    <div class="hero-bg"></div>
    <div class="hero-content">
      <p class="hero-eyebrow">Premium Leather Atelier</p>
      <h1 class="hero-title">LIVIO</h1>
      <div class="hero-divider">
        <div class="hero-divider-line"></div>
        <div class="hero-divider-diamond"></div>
        <div class="hero-divider-line"></div>
      </div>
      <p class="hero-subtitle">Handmade Precision, Timeless Design.</p>
    </div>
  </section>

  <section class="featured">
    <div class="section-header">
      <h2 class="section-title">Koleksiyon</h2>
    </div>

    <div class="product-grid">
      {featuredProducts.length > 0 ? (
        featuredProducts.map((product) => (
          <a href={`/katalog/${product.id}`} class="product-card">
            <img src={product.data.image} alt={product.data.title} class="product-card-img" />
            <div class="product-card-overlay">
              <div class="product-card-info">
                <p class="product-card-id">{product.data.model_id}</p>
                <p class="product-card-name">{product.data.title}</p>
              </div>
            </div>
          </a>
        ))
      ) : (
        <div style="grid-column: 1/-1; text-align: center; padding: 100px; opacity: 0.5; color: #f5f0e8;">
          <p>Henüz ürün eklenmemiş. Lütfen admin panelinden ilk ürününüzü ekleyin.</p>
        </div>
      )}
    </div>
  </section>

  <div class="cursor" id="cursor"></div>
  <div class="cursor-ring" id="cursorRing"></div>
</Layout>

<style>
  .redesign-banner { background: #b8965a; color: #0e0c0a; text-align: center; padding: 6px 0; font-size: 10px; letter-spacing: 0.3em; text-transform: uppercase; position: fixed; top: 0; left: 0; right: 0; z-index: 200; }
  .premium-nav { position: fixed; top: 36px; left: 0; right: 0; z-index: 100; display: flex; align-items: center; justify-content: space-between; padding: 20px 48px; background: rgba(14,12,10,0.8); backdrop-filter: blur(8px); }
  .nav-brand { font-family: 'Cormorant Garamond', serif; font-size: 22px; letter-spacing: 0.35em; color: #f5f0e8; text-decoration: none; }
  .nav-contact { font-size: 9px; letter-spacing: 0.25em; text-transform: uppercase; color: #f5f0e8; border: 1px solid rgba(245,240,232,0.15); padding: 8px 18px; border-radius: 100px; cursor: pointer; background: transparent; }
  .hero { position: relative; min-height: 100vh; display: flex; align-items: center; justify-content: center; background: #0e0c0a; }
  .hero-title { font-family: 'Cormorant Garamond', serif; font-size: clamp(60px, 12vw, 120px); font-weight: 300; letter-spacing: 0.12em; color: #f5f0e8; position: relative; }
  .hero-title::after { content: ''; position: absolute; bottom: 18%; left: -4%; width: 108%; height: 1px; background: #b8965a; opacity: 0.35; }
  .product-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 2px; padding: 0 48px; }
  @media (min-width: 768px) { .product-grid { grid-template-columns: 1.4fr 1fr 1fr 1.4fr; } .product-card:nth-child(1), .product-card:nth-child(4) { grid-row: span 2; } }
  .product-card { position: relative; overflow: hidden; background: #1a1714; }
  .product-card-img { width: 100%; aspect-ratio: 3/4; object-fit: cover; }
  .cursor { position: fixed; width: 8px; height: 8px; background: #b8965a; border-radius: 50%; pointer-events: none; z-index: 9999; mix-blend-mode: difference; }
  .cursor-ring { position: fixed; width: 36px; height: 36px; border: 1px solid #b8965a; border-radius: 50%; pointer-events: none; z-index: 9998; transition: transform 0.1s ease; }
  @media (max-width: 768px) { .cursor, .cursor-ring { display: none; } }
</style>

<script>
  const cursor = document.getElementById('cursor');
  const ring = document.getElementById('cursorRing');
  document.addEventListener('mousemove', (e) => {
    if(cursor && ring) {
      cursor.style.left = e.clientX + 'px'; cursor.style.top = e.clientY + 'px';
      ring.style.left = e.clientX - 14 + 'px'; ring.style.top = e.clientY - 14 + 'px';
    }
  });
  if (window.netlifyIdentity) {
    window.netlifyIdentity.on("init", user => {
      if (!user) { window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; }); }
    });
  }
</script>